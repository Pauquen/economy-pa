<div class="register-container smooth-fade-in">
  <div class="register-card surface-card">
    <!-- Header -->
    <header class="register-header">
      <div class="register-logo">
        <h1 class="logo-text">EconomyRPA</h1>
        <p class="logo-subtitle">Automated Workflow Management</p>
      </div>
    </header>

    <!-- Theme Toggle Outside Header -->
    <div class="theme-toggle-container">
      <button
        class="theme-toggle-premium"
        (click)="toggleTheme()"
        [attr.aria-label]="isDarkTheme() ? 'Switch to light mode' : 'Switch to dark mode'"
        [class.dark-active]="isDarkTheme()"
        title="Toggle theme"
      >
        <div class="toggle-track">
          <div class="toggle-thumb">
            <svg class="icon sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="icon moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </div>
        </div>
      </button>
    </div>

    <!-- Form -->
    <div class="register-form">
      @if (currentStep() === 1) {
        <!-- OAuth Section -->
        <div class="oauth-section">
          <div class="oauth-buttons" style="display: flex; justify-content: center; min-height: 44px;">
            <div id="google-btn"></div>
          </div>

          <div class="oauth-divider">
            <span class="divider-text">or continue with</span>
          </div>
        </div>

        <form
          class="register-form-wrapper"
        >
          <div class="form-group">
            <app-input
              [(modelValue)]="email"
              type="email"
              label="Email Address"
              placeholder="Enter your email"
              [required]="true"
              [disabled]="isLoading()"
              size="lg"
            />
          </div>

          <div class="form-group">
            <app-input
              [(modelValue)]="password"
              type="password"
              label="Password"
              placeholder="Enter your password"
              [required]="true"
              [disabled]="isLoading()"
              [maxLength]="50"
              size="lg"
            />
          </div>

          <div class="form-group">
            <app-input
              [(modelValue)]="confirmPassword"
              type="password"
              label="Confirm Password"
              placeholder="Confirm your password"
              [required]="true"
              [disabled]="isLoading()"
              [maxLength]="50"
              size="lg"
            />
          </div>

          <div class="form-actions">
            <app-button
              type="submit"
              variant="primary"
              size="lg"
              [isLoading]="isLoading()"
              (click)="nextStep()"
              [disabled]="!isStep1Valid()"
              style="width: 100%"
            >
              {{ isLoading() ? 'Signing in...' : 'Continue' }}
            </app-button>
          </div>
        </form>

        <div class="login-redirect">
          <p class="redirect-text">
            Already have an account? 
            <a routerLink="/login" class="login-link">Log in</a>
          </p>
        </div>
      }

      @if (currentStep() === 2) {
        <div class="step-animation">
          <app-input 
            label="Full Name" 
            (modelValue)="fullName()" 
            (valueChange)="fullName.set($event)" 
            placeholder="John Doe" 
            [required]="true"
          />

          <div class="custom-select-group">
            <label class="group-label">Select your role</label>
            <div class="role-grid">
              <div class="role-option" [class.active]="role() === 'manager'" (click)="role.set('manager')">
                <span class="material-symbols-outlined role-icon">manage_accounts</span>
                <span>Manager</span>
              </div>
              <div class="role-option" [class.active]="role() === 'operator'" (click)="role.set('operator')">
                <span class="material-symbols-outlined role-icon">engineering</span>
                <span>Operator</span>
              </div>
            </div>
          </div>

          <div class="custom-select-group">
            <label class="group-label">Lenguange</label>
            <div class="lang-pills">
              <button class="pill" [class.active]="lenguange() === 'en'" (click)="lenguange.set('en')">English</button>
              <button class="pill" [class.active]="lenguange() === 'es'" (click)="lenguange.set('es')">Spanish</button>
            </div>
          </div>

          <div class="actions">
            <button class="btn-back-minimal" (click)="prevStep()" title="Volver">
              <span class="material-symbols-outlined">arrow_back</span>
            </button>

            <app-button (click)="nextStep()" [disabled]="!isStep2Valid()" size="lg" class="flex-1">
              Finalizar Configuración
            </app-button>
          </div>
        </div>
      }

      @if (currentStep() === 3) {
        <div class="step-animation review-step">
          <div class="review-header">
            <span class="material-symbols-outlined success-icon-glow">verified_user</span>
            <h3>Verifica tu información</h3>
            <p>Casi hemos terminado. Revisa que todo sea correcto.</p>
          </div>

          <div class="summary-card">
            <div class="summary-item">
              <span class="material-symbols-outlined">person</span>
              <div class="info">
                <label>Nombre</label>
                <span>{{ fullName() || 'No especificado' }}</span>
              </div>
            </div>

            <div class="summary-item">
              <span class="material-symbols-outlined">mail</span>
              <div class="info">
                <label>Email</label>
                <span>{{ email() }}</span>
              </div>
            </div>

            <div class="summary-item">
              <span class="material-symbols-outlined">badge</span>
              <div class="info">
                <label>Rol asignado</label>
                <span class="capitalize">{{ role() || 'Usuario' }}</span>
              </div>
            </div>

            <div class="summary-item">
              <span class="material-symbols-outlined">language</span>
              <div class="info">
                <label>Idioma</label>
                <span>{{ lenguange() === 'es' ? 'Español' : 'English' }}</span>
              </div>
            </div>
          </div>

          <div class="terms-wrapper">
            <label class="custom-checkbox-container">
              <div class="checkbox-input-wrapper">
                <input 
                  type="checkbox" 
                  [checked]="agreedToTerms()" 
                  (change)="agreedToTerms.set(!agreedToTerms())"
                >
                <div class="checkbox-visual">
                  <span class="material-symbols-outlined">check</span>
                </div>
              </div>
              
              <span class="terms-text">
                Acepto los 
                <a href="" target="_blank" (click)="$event.stopPropagation()" class="legal-link">Términos de Servicio</a> 
                y la 
                <a href="" target="_blank" (click)="$event.stopPropagation()" class="legal-link">Política de Privacidad</a>.
              </span>
            </label>
          </div>

          <div class="actions">
            <button class="btn-back-minimal" (click)="prevStep()" title="Regresar">
              <span class="material-symbols-outlined">arrow_back</span>
            </button>

            <app-button 
              (click)="onSubmit()" 
              [isLoading]="isLoading()" 
              size="lg" 
              class="flex-1 btn-confirm">
              <span class="btn-content">
                Confirmar y Crear Cuenta
              </span>
            </app-button>
          </div>
        </div>
      }

      <div class="step-progress-bar" [style.width]="(currentStep() / totalSteps * 100) + '%'"></div>
    </div>
</div>
